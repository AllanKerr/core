<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
		<title>ButtonMixin test</title>
		<script src="/node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
		<script src="/node_modules/mocha/mocha.js"></script>
		<script src="/node_modules/chai/chai.js"></script>
		<script src="/node_modules/@polymer/test-fixture/test-fixture.js"></script>
		<script src="/node_modules/wct-mocha/wct-mocha.js"></script>
		<script type="module" src="./test-button-elem.js"></script>
	</head>
	<body>
		<test-fixture id="basic">
			<template>
				<test-button-elem></test-button-elem>
			</template>
		</test-fixture>

		<test-fixture id="disabled">
			<template>
				<test-button-elem disabled></test-button-elem>
			</template>
		</test-fixture>

		<test-fixture id="aria-label">
			<template>
				<test-button-elem aria-label="test button"></test-button-elem>
			</template>
		</test-fixture>

		<test-fixture id="text-aria-label">
			<template>
				<test-button-elem text-aria-label="test button text"></test-button-elem>
			</template>
		</test-fixture>

		<test-fixture id="text-and-aria-label">
			<template>
				<test-button-elem text-aria-label="test button text 1" aria-label="test button text 2"></test-button-elem>
			</template>
		</test-fixture>

		<script type="module">
			describe('ButtonMixin', () => {
				let button;
				beforeEach(async() => {
					button = fixture('basic');
					await button.updateComplete;
				});

				it('should use "type" defaulting to "button"', () => {
					expect(button.type).to.equal('button');
				});

				it('should call button focus', async() => {
					return new Promise(resolve => {
						button.shadowRoot.querySelector('button').addEventListener('focus', resolve, {once: true});
						button.focus();
					});
				});

				it('should stop propagation if button is disabled', async() => {
					const disabledButton = fixture('disabled');
					await disabledButton.updateComplete;

					return new Promise((resolve, reject) => {
						document.addEventListener('click', () => {
							reject();
						}, {once: true});
						disabledButton.click();
						setTimeout(resolve, 500); // pass test if parent click eventlistener never called
					});
				});

				it('should use aria-label if defined and no text-aria-label', async() => {
					const ariaLabelFixture = fixture('aria-label');
					await ariaLabelFixture.updateComplete;

					expect(ariaLabelFixture.shadowRoot.querySelector('button').getAttribute('aria-label')).to.equal('test button');
				});

				it('should use text-aria-label if defined', async() => {
					const textAriaLabelFixture = fixture('text-aria-label');
					await textAriaLabelFixture.updateComplete;

					expect(textAriaLabelFixture.shadowRoot.querySelector('button').getAttribute('aria-label')).to.equal('test button text');
				});

				it('should use text-aria-label if defined and aria-label also defined', async() => {
					const textAndAriaLabelFixture = fixture('text-and-aria-label');
					await textAndAriaLabelFixture.updateComplete;

					expect(textAndAriaLabelFixture.shadowRoot.querySelector('button').getAttribute('aria-label')).to.equal('test button text 1');
				});
			});
		</script>
	</body>
</html>
